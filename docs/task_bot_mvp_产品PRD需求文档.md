# 产品需求文档（PRD）——飞书远程任务 Bot MVP（修订 v1.1）

> **定位**：远程兼职人员 & AI 助手的“做什么、为何做”指南。已融合：
> • 简历自动解析 → 候选人表
> • LLM 直出 **Top‑2**（候选人列表最多 15 条）
> • 自动提醒 = 交付周期过半催一次
> • 关闭 CI 自动补丁循环

---

## 1  产品概述

* **核心目标**：在飞书里 10 秒完成任务创建与指派，Bot 自动验收首轮结果，HR 手动消息降 50 %。
* **痛点**：人工筛人、催进度、验收耗时高；信息散落聊天记录。

## 2  用户与需求

| 角色       | 主要需求          | 价值指标          |
| -------- | ------------- | ------------- |
| HR / 协调者 | 快速派人、少催促、自动统计 | 手动消息数 ↓50 %   |
| 任务发布者    | 一句指令即可派活      | 创建→指派 ≤10 s   |
| 远程兼职人员   | 需求清晰、即时反馈     | 首轮验收反馈 ≤1 min |

## 3  功能列表（MoSCoW）

### 3.1  必须实现（MUST）

1. **任务创建**：`@bot 新任务:` 触发；Bot 追问 描述 / 验收 / 技能 / DDL。
2. **智能匹配 (Top‑2)**：Bot 调 LLM，将**候选人表最新 ≤15 人**与任务需求对比，返回最合适 **Top‑2** 卡片（含一句理由，不含分数）。
3. **一键指派**：HR 点 **✅ 选 TA** → Bot 创建子群 `T-<id>-<标题>` 并邀请承接人。
4. **进度提醒**：当 **已过去时间 ≥ 总周期 50 %** 且任务仍 In‑Progress → Bot @承接人 + HR。
5. **自动验收（首轮）**：

   * 代码：GitHub CI/Lint 全绿即通过。
   * 非代码：LLM 评分 ≥80 通过。
   * 未通过：Bot ❌ + `failedReasons[]`，承接人可重试 2 次。
6. **日报 / KPI**：`#report` 输出 今日任务统计 + 平均指派耗时。
7. **候选人信息维护**：HR 上传简历 → Bot 用 LLM 解析成 JSON（姓名、email、技能、工时、raw\_text…）写入候选人表；指令检索/修改。
8. **任务信息维护**：HR 可在多维表或指令增删改任务行，Bot 同步状态。

### 3.2  应该实现（SHOULD）

* 子群归档：任务 Done 7 天后 Bot 改名 `[ARCHIVED]` 并退群。

### 3.3  可选 / 不做（MVP 外）

* 多人子任务拆分、绩效预测、跨租户支持。

## 4  业务流程图

```mermaid
graph TD
  A(任务发布者/HR) -- 新任务指令 --> B[Bot 追问字段]
  B --> C[LLM 匹配 Top‑2]
  C --> D{HR 选 TA}
  D --> E[Bot 创建子群+邀请]
  E --> F(承接人 工作中)
  F --> G[/done 提交]
  G --> H{自动验收}
  H -- 通过 --> I[Done + 归档计时]
  H -- 未通过 --> F
```

## 5  功能详情

| 编号   | 功能           | 输入           | 处理                   | 输出                  |
| ---- | ------------ | ------------ | -------------------- | ------------------- |
| F‑01 | 任务创建 & 追问    | 指令 + 字段      | Bot Thread 追问        | 草稿写入任务表             |
| F‑02 | LLM 匹配 Top‑2 | 草稿 + 候选人 ≤15 | Prompt 生成 Top‑2 + 理由 | 卡片消息                |
| F‑03 | 指派           | HR 点按钮       | `chat.create`        | 子群 + 状态 In‑Progress |
| F‑04 | 进度提醒         | 定时器          | 如果已过半且无 /done        | Bot @承接人+HR         |
| F‑05 | 自动验收         | `/done 链接`   | 见 5.1                | 🎉 / ❌              |
| F‑06 | 日报           | `#report`    | 聚合任务表                | KPI 文本              |
| F‑07 | 候选人入库        | PDF/Word 简历  | LLM 解析→写表            | 候选人行更新              |
| F‑08 | 任务维护         | 表单/指令        | CRUD + Bot 同步        | 状态即时更新              |

### 5.1  自动验收逻辑

```python
if task.is_code:
    pass_ = github_ci_green(pr_url)
else:
    score = llm_score(submission_url, acceptance)
    pass_ = score >= 80
```

## 6  非功能需求

| 指标     | 目标          |
| ------ | ----------- |
| Bot 延迟 | <1 s（LLM 外） |
| LLM 调用 | <8 s        |
| 单测覆盖   | ≥60 %       |
| Uptime | ≥99 %       |

## 7  边界与风控

* LLM API 超时：Bot 提示“AI 延迟”，状态不变。
* GitHub Webhook 去重：比对 `delivery_id`。
* 候选人列表截断：超过 15 条时仅取最近更新的 15 人。

---

> **版本 v1.1** — 更新：
> • 匹配改为 LLM Top‑2（≤15 候选）
> • 进度提醒改为“周期过半催一次”
> • 简历自动解析入库；关闭 CI 自动补丁循环
