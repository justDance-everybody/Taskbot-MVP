# 产品需求文档（PRD）——飞书远程任务 Bot MVP

> **文档定位**  专供远程实习生（2 年开发经验）阅读，并供 AI 编程助手作为输入。描述“要做什么”与“为何这样做”，不涉及具体代码细节。

---

## 1. 产品概述

- **产品名称**：飞书远程任务 Bot（MVP）
- **核心目标**：让 HR / 用人部门在飞书内 10 秒内完成任务创建与指派，远程兼职人员在同一子群完成沟通与交付，Bot 自动完成首轮验收并提供反馈，HR 交互次数减少 ≥ 50 %。
- **痛点**：当前人工筛人、催进度、手动验收，信息散落聊天记录，耗时高且可追溯性差。

## 2. 用户与需求

| 角色                | 主要需求             | 价值指标            |
| ----------------- | ---------------- | --------------- |
| **HR / 协调者**      | 快速派人、少催促、自动统计    | 日均手动消息数 ↓50%    |
| **任务发布者（PM/工程师）** | 一条命令即可派活，不找人、不填表 | 任务创建→指派 ≤10 s   |
| **远程兼职人员**        | 需求清晰、即时反馈、少往返    | 首轮验收自动反馈 ≤1 min |

## 3. 功能列表（MoSCoW）

### 3.1  必须实现（MUST）

1. **任务创建**：HR/发布者在控制室群 `@bot 新任务: <标题>` 触发；Bot 追问缺字段（描述、验收标准、技能标签、DDL）。
2. **智能匹配**：Bot 调用 LLM 根据“技能标签 + 可用工时 + 绩效”计算匹配分，生成 Top‑3 候选人卡片。
3. **一键指派**：HR 点击 **✅ 选 TA** → Bot 自动创建子群 `T-<id>-<标题>` 并邀请承接人。
4. **进度提醒**：子群 48 h 无 `/done` 或 CI 提交 → Bot @ 承接人 + HR。
5. **自动验收（首轮）**：
   - 代码任务：Bot 拉取 GitHub CI/Lint 结果（全绿视为通过）。
   - 非代码任务：Bot 调用 LLM 评分；得分 ≥ 80 视为通过。
   - 未通过：Bot 生成 `failedReasons[]` 并允许承接人 **最多 2 次** 重试，无需 HR 介入。
6. **日报 / KPI**：HR 在控制室群输入 `#report`，Bot 输出当日 “新任务、进行中、已通过、平均指派耗时”。

### 3.2  应该实现（SHOULD）

- 子群归档：任务通过 7 天后 Bot 自动加前缀 `[ARCHIVED]` 并退群。
- HR 可在多维表手动修改任务状态，Bot 同步到群内。

### 3.3  可选 & 不做（COULD / WON’T in MVP）

- 多人子任务拆分、绩效预测、跨租户支持等。

## 4. 业务流程图

```mermaid
graph TD
  A(任务发布者/HR) -- @bot 新任务 --> B[Bot 追问字段]
  B --> C[LLM 匹配 Top‑3]
  C --> D{HR 选候选}
  D --> E[Bot 创建子群 + 邀请]
  E --> F(承接人 开始工作)
  F --> G[/done + 提交链接]
  G --> H{自动验收}
  H -- 通过 --> I[状态 Done +归档计时]
  H -- 未通过 --> F
```

## 5. 功能详情

| 编号   | 功能        | 输入              | 处理                      | 输出                         |
| ---- | --------- | --------------- | ----------------------- | -------------------------- |
| F‑01 | 任务创建 & 追问 | `@bot 新任务` + 字段 | Bot 在 Thread 追问缺项       | 任务草稿行写入多维表                 |
| F‑02 | LLM 匹配    | 草稿行 + 人才表       | 调用 Prompt 计算 matchScore | Top‑3 卡片                   |
| F‑03 | 指派        | HR 点击按钮         | Bot 调 `chat.create`     | 子群 + 任务 status=In‑Progress |
| F‑04 | 进度提醒      | 时钟 48 h         | 查询子群最后活动时间              | @ 承接人 + HR                 |
| F‑05 | 自动验收      | `/done 链接`      | 见 5.1 验收逻辑              | 🎉 通过 / ❌ 未通过              |
| F‑06 | 日报        | `#report`       | 聚合表中数据                  | KPI 摘要消息                   |

### 5.1 自动验收逻辑

```
if task.type = code:
    if CI_state == green: pass
    else: fail(reason='CI red')
else:
    score = LLM_score(submission, acceptance)
    pass if score >= 80 else fail(reason=list)
```

## 6. 非功能需求

| 指标         | 目标            |
| ---------- | ------------- |
| Bot 响应延迟   | < 1 秒（不含 LLM） |
| LLM 调用平均时长 | < 8 秒         |
| 单测覆盖率      | ≥ 60 %        |
| Uptime     | ≥ 99 % 办公时间   |

## 7. 边界与风控

- LLM API 超时：Bot 回复“AI 延迟，请稍后重试”，不改变状态。
- GitHub Webhook 重放：使用 `delivery_id` 去重。
- 子群超量：最多 200 子群/月，归档后自动退出节省配额。

---

> **版本** v1.0 – 提交人：XXX，日期：2025‑06‑18。 修改记录：
>
> - v0.9 → v1.0：新增 F‑05 自动验收步骤与失败自动回退说明；补充功能概述，使远程开发者可直观理解“交付什么”。

